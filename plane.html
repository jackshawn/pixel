<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>灰机大战</title>
    <style>
        body, input {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<script>
    (function () {
        var w = document.documentElement.clientWidth;
        var h = document.documentElement.clientHeight;

        console.log(w + ' ' + h);
        var x = Math.floor(w / 13);
        var y = Math.floor(h / 18);
        for (var a = 0; a < x * y; a++) {
            var inputs = document.createElement('input');
            inputs.type = 'radio';
            document.body.appendChild(inputs)
        }

        var btns = document.getElementsByTagName('input');

        function model() {
            this.plane = [[0, -2], [0, -1], [-3, 0], [-2, 0], [-1, 0], [0, 0], [1, 0], [2, 0], [3, 0], [0, 1], [-1, 2], [0, 2], [1, 2]];
            this.name = [
                [[0, -3], [0, -2], [0, 1], [-1, -2], [-1, -1], [-1, 0], [-1, 2], [-2, -2], [-2, 0], [-2, 3], [-3, -2], [-3, 1], [-4, 2], [-5, 3], [1, 0], [1, -1], [1, -2], [1, -4], [1, 1], [2, -2], [2, 1], [2, 2], [3, 0], [3, -2], [3, 3], [4, -2], [4, 3]],
                [[0, -2], [0, 1], [-1, 0], [-1, -2], [-2, -4], [-2, -3], [-2, -2], [-2, -1], [-2, 0], [-2, 1], [-2, 2], [-2, 3], [-3, -2], [-3, 0], [-4, -2], [-4, 1], [-5, 2], [1, 3], [2, 2], [2, -2], [2, -1], [2, 0], [2, 1], [3, -2], [4, -2], [4, -1], [4, 0], [4, 1], [4, 2], [5, 3], [6, 2]],
                [[0, -1], [0, -2], [0, -3], [0, -4], [-1, -2], [-1, 0], [-2, -2], [-2, 1], [-3, -2], [-3, 2], [-4, -2], [-4, 3], [1, -2], [1, 0], [2, -2], [2, 1], [3, -2], [3, 2], [4, -2], [4, 3]],
                [[0, -4], [0, -2], [0,3],[-1, -3], [-2, -3], [-2, -1], [-2, 0], [-2, 1], [-2, 2], [-3, -1], [-3, -2], [-3, -3], [-3, -4], [-3, 2], [-4, -1], [-4, 0], [-4, 1], [-4, 2], [1, -3], [1, -2], [1, 2], [2, -2], [2, -1], [2, 1], [3, 0], [3, -2], [3, 0], [4, 1], [4, -1], [4, -2], [4, -4], [5, -2], [5, -3], [5, 2], [6, 1],[6,2],[6,3]]
            ]
        }
        model.prototype = {
            layout : function(i, arr, state) {
                var newstate = (state == 'show') ? 'checked' : '';
                var newi;
                for (var b = 0; b < arr.length; b++) {
                    newi = Math.floor(i + arr[b][0] + arr[b][1] * x);
                    if ((newi > 0) && (newi < btns.length)) {
                        btns[newi].checked = newstate;
                    }
                }
            },
            fire : function(i) {
                var _this = this;
                var c = -4;
                setInterval(function () {
                    if (Math.floor(i / x) + c > -4) {
                        _this.layout(i, [[0, c]], 'show');
                        _this.layout(i, [[0, c + 1]], 'hide');
                    }
                    c--
                }, 80)
            },
            showname : function() {
                var _this = this;
                var setname = function (num) {
                    return Math.floor(x * num) + Math.floor(y * 2 / 5) * x;
                };
                var z = 0;
                setInterval(function () {
                    if (z < 4) {
                        _this.layout(setname(.2 * (1 + z)), newmodel.name[z], 'show');
                    }
                    if (z > 4 && z < 9) {
                        var i;
                        for (i = 0; i < btns.length; i++) {
                            (btns[i].checked == '') ? btns[i].checked = 'checked' : btns[i].checked = '';
                        }
                    }
                    z++;
                }, 300);
            },
            move : function(i, arr, t) {
                var _this = this;
                setInterval(function () {
                    if (t > 0) {
                        for (c = 0; c < arr.length; c++) {
                            _this.layout(i, arr, 'hide');
                            arr[c][1]--;
                            _this.layout(i, arr, 'show');
                        }
                    }
                    t--;
                }, 100)
            }
        }

        var newmodel = new model();

        newmodel.move(x * y - x * .5, (new model().plane), 7);
        newmodel.showname();
        document.body.onclick = (function () {
            var clicked = false;
            return function () {
                if (!clicked) {
                    var i;
                    for (i = 0; i < btns.length; i++) {
                        btns[i].checked = '';
                    }
                    for (i = 0; i < btns.length; i++) {
                        (function (i) {
                            btns[i].onmouseover = function () {
                                newmodel.layout(i, newmodel.plane, 'show');
                                newmodel.fire(i)
                            };
                            btns[i].onmouseout = function () {
                                newmodel.layout(i, newmodel.plane, 'hide');

                            }
                        })(i)
                    }
                    clicked = true;
                }
            }
        })();
    })()
</script>
</body>
</html>