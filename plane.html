<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>灰机大战</title>
    <style>
        body, input {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<script>
    (function () {
        var w = document.documentElement.clientWidth;
        var h = document.documentElement.clientHeight;
        console.log(w + ' ' + h);
        Number.prototype.quz = function () {
            return Math.floor(this);
        };
        var x = (w / 13).quz();
        var y = (h / 18).quz();
        var all = x * y;

        function each() {
            var a;
            var arrlength = (arguments.length == 2) ? arguments[0].length : all;
            for (a = 0; a < arrlength; a++) {
                arguments[arguments.length - 1](a);
            }
        }

        each(function () {
            var inputs = document.createElement('input');
            inputs.type = 'radio';
            document.body.appendChild(inputs)
        });
        var btns = document.getElementsByTagName('input');

        function model() {
            this.plane = [[0, -2], [0, -1], [-3, 0], [-2, 0], [-1, 0], [0, 0], [1, 0], [2, 0], [3, 0], [0, 1], [-1, 2], [0, 2], [1, 2]];
            this.name = [
                [[0, -3], [0, -2], [0, 1], [-1, -2], [-1, -1], [-1, 0], [-1, 2], [-2, -2], [-2, 0], [-2, 3], [-3, -2], [-3, 1], [-4, 2], [-5, 3], [1, 0], [1, -1], [1, -2], [1, -4], [1, 1], [2, -2], [2, 1], [2, 2], [3, 0], [3, -2], [3, 3], [4, -2], [4, 3]],
                [[0, -2], [0, 1], [-1, 0], [-1, -2], [-2, -4], [-2, -3], [-2, -2], [-2, -1], [-2, 0], [-2, 1], [-2, 2], [-2, 3], [-3, -2], [-3, 0], [-4, -2], [-4, 1], [-5, 2], [1, 3], [2, 2], [2, -2], [2, -1], [2, 0], [2, 1], [3, -2], [4, -2], [4, -1], [4, 0], [4, 1], [4, 2], [5, 3], [6, 2]],
                [[0, -1], [0, -2], [0, -3], [0, -4], [-1, -2], [-1, 0], [-2, -2], [-2, 1], [-3, -2], [-3, 2], [-4, -2], [-4, 3], [1, -2], [1, 0], [2, -2], [2, 1], [3, -2], [3, 2], [4, -2], [4, 3]],
                [[0, -4], [0, -2], [0, 3], [-1, -3], [-2, -3], [-2, -1], [-2, 0], [-2, 1], [-2, 2], [-3, -1], [-3, -2], [-3, -3], [-3, -4], [-3, 2], [-4, -1], [-4, 0], [-4, 1], [-4, 2], [1, -3], [1, -2], [1, 2], [2, -2], [2, -1], [2, 1], [3, 0], [3, -2], [3, 0], [4, 1], [4, -1], [4, -2], [4, -4], [5, -2], [5, -3], [5, 2], [6, 1], [6, 2], [6, 3]]
            ]
        }

        model.prototype = {
            layout: function (i, arr, state) {
                var newstate = (state == 'show') ? 'checked' : '';
                var newi;
                each(arr, function (a) {
                    newi = i + arr[a][0] + arr[a][1] * x;
                    if ((newi > 0) && (newi < all)) {
                        btns[newi].checked = newstate;
                    }
                });
            },
            xy_i: function (arg) {
                if (typeof arg == 'number') {
                    return [arg % x, (arg / x).quz()]
                }
                if (typeof arg == 'object') {
                    return (arg[0] - 1) * x + arg[1];
                }
                else {
                    console.log('arg erro')
                }
            },
            fire: function (i) {
                this.move(i, [[0, -4]]);
            },
            line: function (towards, start, end) {
                switch (towards) {
                    case 'x':
                        each(function (i) {
                            if (i > start && i < end) {
                                btns[i].checked = 'checked';
                            }
                        });
                        break;
                    case 'y':
                        var liney = end % x;
                        each(function (i) {
                            if (i > start && i < end && (i % x == liney)) {
                                btns[i].checked = 'checked';
                            }
                        });
                        break;
                    default:
                        console.log('towards erro')
                }
            },
            box: function (start, end) {
                var top_left = start;
                var top_right = start + end % x - start % x;
                var bottom_left = (end / x).quz() * x + start % x;
                var bottom_right = end;
                this.line('x', top_left, top_right);
                this.line('x', bottom_left, bottom_right);
                this.line('y', top_left, bottom_left);
                this.line('y', top_right, bottom_right);
            },
            showname: function () {
                var _this = this;
                var z = 0;
                var t_y = (y * 3 / 8).quz() * x;

                function name() {
                    function setname(num) {
                        return (x * num).quz() + t_y;
                    }

                    _this.layout(setname(.2 * (1 + z)), newmodel.name[z], 'show');
                }

                function shine() {
                    each(function (i) {
                        (btns[i].checked == '') ? btns[i].checked = 'checked' : btns[i].checked = '';
                    })
                }

                var toshow = setInterval(function () {
                    if (z < 4) {
                        name();
                    }
                    if (z == 4) {
                        var start = t_y - x * 6 + 6;
                        var end = start + x * 13 - 12;
                        _this.box(start, end);
                    }
                    if (z > 4 && z < 9) {
                        shine();
                    }
                    if (z == 9) {
                        clearInterval(toshow);
                    }
                    z++;
                }, 300);
            },
            move: function (i, arr, t) {
                var _this = this;
                t = (arguments.length == 3) ? arguments[2] : (i / x).quz();
                var tomove = setInterval(function () {
                    if (t > 0) {
                        for (c = 0; c < arr.length; c++) {
                            _this.layout(i, arr, 'hide');
                            arr[c][1]--;
                            _this.layout(i, arr, 'show');
                        }
                    } else {
                        clearInterval(tomove);
                    }
                    t--;
                }, 100)
            }
        };
    var newmodel = new model();
    newmodel.move(all - (x / 2).quz(), (new model().plane), 7);
    newmodel.showname();
    document.body.onclick = (function () {
      var clicked = false;
      return function () {
        if (!clicked) {
          each(function (a) {
            btns[a].checked = '';
            (function (i) {
              btns[i].onmouseover = function () {
                newmodel.layout(i, newmodel.plane, 'show');
                newmodel.fire(i)
              };
              btns[i].onmouseout = function () {
                newmodel.layout(i, newmodel.plane, 'hide');
              }
            })(a)
          });
          clicked = true;
        }
      }
    })();
  })()
</script>   
 </body>
</html>
